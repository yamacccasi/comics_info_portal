{"ast":null,"code":"import'./charList.scss';import Spinner from'../spinner/Spinner';import ErrorMessage from'../errorMessage/ErrorMessage';import MarvelService from\"../../services/MarvelService\";import{Component}from\"react\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";class CharList extends Component{constructor(){super(...arguments);this.state={charList:[],loading:true,error:false,newItemLoading:false,offset:210,charEnded:false};this.marvelService=new MarvelService();this.onRequest=offset=>{this.onCharListLoading();this.marvelService.getAllCharacters(offset).then(this.onCharListLoaded).catch(this.onError);};this.onCharListLoading=()=>{this.setState({newItemLoading:true});};this.itemRefs=[];this.setRef=ref=>{this.itemRefs.push(ref);// пушим в массив refs, елементи рендеру\n};this.focusOnItem=id=>{// id = порядковий номер li в массиві itemRefs\nthis.itemRefs.forEach(item=>item.classList.remove('char__item_selected'));this.itemRefs[id].classList.add('char__item_selected');this.itemRefs[id].focus();};this.onCharListLoaded=newCharList=>{let ended=false;if(newCharList.length<9){ended=true;}this.setState(_ref=>{let{offset,charList}=_ref;return{charList:[...charList,...newCharList],loading:false,newItemLoading:false,offset:210+9,chaEnded:ended};});};this.onError=()=>{this.setState({error:true,loading:false});};}componentDidMount(){this.onRequest(210);}renderItems(arr){const items=arr.map((item,i)=>{let imgStyle={'objectFit':'cover'};if(item.thumbnail==='http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg'){imgStyle={'objectFit':'unset'};}return/*#__PURE__*/_jsxs(\"li\",{className:\"char__item\",ref:this.setRef,tabIndex:0,onClick:()=>{this.props.onCharSelected(item.id);this.focusOnItem(i);},onKeyPress:e=>{if(e.key===''||e.key==='Enter'){this.props.onCharSelected(item.id);this.focusOnItem(i);}},children:[/*#__PURE__*/_jsx(\"img\",{src:item.thumbnail,alt:item.name,style:imgStyle}),/*#__PURE__*/_jsx(\"div\",{className:\"char__name\",children:item.name})]},item.id);});return/*#__PURE__*/_jsx(\"ul\",{className:\"char__grid\",children:items});}render(){const{charList,loading,error,offset,newItemLoading,charEnded}=this.state;const items=this.renderItems(charList);const errorMessage=error?/*#__PURE__*/_jsx(ErrorMessage,{}):null;const spinner=loading?/*#__PURE__*/_jsx(Spinner,{}):null;const content=!(loading||error)?items:null;return/*#__PURE__*/_jsxs(\"div\",{className:\"char__list\",children:[errorMessage,spinner,content,/*#__PURE__*/_jsx(\"button\",{className:\"button button__main button__long\",children:/*#__PURE__*/_jsx(\"div\",{className:\"inner\",onClick:()=>this.onRequest(offset)// disabled={newItemLoading}\n,style:{'display':charEnded?'none':'block'},children:\"load more\"})})]});}}export default CharList;","map":{"version":3,"names":["Spinner","ErrorMessage","MarvelService","Component","jsx","_jsx","jsxs","_jsxs","CharList","constructor","arguments","state","charList","loading","error","newItemLoading","offset","charEnded","marvelService","onRequest","onCharListLoading","getAllCharacters","then","onCharListLoaded","catch","onError","setState","itemRefs","setRef","ref","push","focusOnItem","id","forEach","item","classList","remove","add","focus","newCharList","ended","length","_ref","chaEnded","componentDidMount","renderItems","arr","items","map","i","imgStyle","thumbnail","className","tabIndex","onClick","props","onCharSelected","onKeyPress","e","key","children","src","alt","name","style","render","errorMessage","spinner","content"],"sources":["/Users/maxympetlyak/Desktop/REACT/marvel_starter/src/components/charList/CharList.js"],"sourcesContent":["import './charList.scss';\nimport Spinner from '../spinner/Spinner';\nimport ErrorMessage from '../errorMessage/ErrorMessage';\nimport MarvelService from \"../../services/MarvelService\";\nimport {Component} from \"react\";\nimport {PropTypes} from \"prop-types\";\n\n\nclass CharList extends Component  {\n\n    state = {\n        charList : [],\n        loading: true,\n        error: false,\n        newItemLoading: false,\n        offset: 210,\n        charEnded:false\n    }\n     marvelService = new MarvelService();\n\n    componentDidMount() {\n        this.onRequest(210);\n    }\n\n    onRequest = (offset) => {\n        this.onCharListLoading()\n        this.marvelService.getAllCharacters(offset)\n            .then(this.onCharListLoaded)\n            .catch(this.onError)\n    }\n\n    onCharListLoading = () => {\n        this.setState({\n            newItemLoading: true\n        });\n    }\n\n    itemRefs = [];\n\n    setRef = ref => {\n        this.itemRefs.push(ref)   // пушим в массив refs, елементи рендеру\n    }\n\n    focusOnItem = (id) => {    // id = порядковий номер li в массиві itemRefs\n        this.itemRefs.forEach(item => item.classList.remove('char__item_selected'))\n        this.itemRefs[id].classList.add('char__item_selected');\n        this.itemRefs[id].focus();\n    }\n\n\n    onCharListLoaded = (newCharList) => {\n        let ended = false;\n        if(newCharList.length < 9) {\n            ended = true;\n        }\n\n        this.setState(({offset, charList,}) => ({\n            charList : [...charList, ...newCharList ],\n            loading: false,\n            newItemLoading: false,\n            offset: 210 + 9,\n            chaEnded: ended\n        }))\n\n    }\n\n    onError = () => {\n        this.setState({\n            error: true,\n            loading: false\n        })\n    }\n\n    renderItems(arr) {\n        const items = arr.map((item, i) => {\n            let imgStyle = {'objectFit' : 'cover'};\n            if (item.thumbnail === 'http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg') {\n                imgStyle = {'objectFit' : 'unset'};\n            }\n\n            return (\n                <li\n                    className=\"char__item\"\n                    key={item.id}\n                    ref={this.setRef}\n                    tabIndex={0}\n                    onClick={() => {\n                    this.props.onCharSelected(item.id)\n                    this.focusOnItem(i) }}\n                    onKeyPress={(e) => {\n                        if(e.key === '' || e.key === 'Enter') {\n                            this.props.onCharSelected(item.id)\n                            this.focusOnItem(i)}}}>\n                <img src={item.thumbnail} alt={item.name} style={imgStyle}/>\n                <div className=\"char__name\">{item.name}</div>\n            </li>\n            )\n        });\n\n        return (\n            <ul className='char__grid'>\n                {items}\n            </ul>\n        )\n    }\n\n    render() {\n        const {charList, loading, error,offset,newItemLoading,charEnded} = this.state;\n\n        const items = this.renderItems(charList);\n\n        const errorMessage = error ? <ErrorMessage/> : null;\n        const spinner = loading ? <Spinner/> : null;\n        const content = !(loading || error) ? items : null;\n        return (\n            <div className=\"char__list\">\n                {errorMessage}\n                {spinner}\n                {content}\n            <button className=\"button button__main button__long\">\n                <div\n                    className=\"inner\"\n                    onClick={() => this.onRequest(offset)}\n                    // disabled={newItemLoading}\n                    style={{'display': charEnded ? 'none' : 'block'}}\n                >load more</div>\n            </button>\n        </div>\n    )\n        }\n}\n\nCharList.propTypes = {\n    onCharSelected: PropTypes.func.isRequired,\n}\n\nexport default CharList;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}